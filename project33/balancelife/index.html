<!DOCTYPE html>
<!-- http-server --cors --ssl -c-1 -p 8080 -a 127.0.0.1  -->
<!-- https://www.facebook.com/embed/instantgames/xxxxxx/player?game_url=https://127.0.0.1:8080 -->
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Meta Instant Game</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: #000000;
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            font-family: sans-serif;
            overflow: hidden;
        }

        .container {
            position: relative;
            /* Anchors the child */
            width: 800px;
            height: 600px;
        }

        .base-layer {
            width: 100%;
            height: 100%;
            background: green;
            /* Represents your game */
        }

        .overlay-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0);
            /* Semi-transparent black */
            z-index: 10;
            /* Ensures it is on top */

            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
        }

        #top_profile {}

        #game-status {
            text-align: center;
            top: -100px;
            z-index: 10;
        }
    </style>
    <script src="https://connect.facebook.net/en_US/fbinstant.8.0.js"></script>
    <script src="planck.js"></script>
    <script src="phaser.min.js"></script>
    <script src="game.js"></script>
    <script src="ActionManager.js"></script>
</head>

<body>
    <div class="container">
        <div id="top_profile"></div>
        <div id="thegame"></div>
        <div id="game-status" class="overlay-layer">Loading Game...</div>
        <div id="fb-sdk-cmd-selector" class="overlay-layer">
            <select id="actionSelector" onchange="handleSelection()">
                <option value="">▼ BASIC ▼</option>
                <option value="FBInstant.getSDKVersion">FBInstant.getSDKVersion</option>
                <option value="FBInstant.getPlatform">FBInstant.getPlatform</option>
                <option value="FBInstant.getSupportedAPIs">FBInstant.getSupportedAPIs</option>
                <option value="">▼ LOGEVENT ▼</option>
                <option value="logEvent.purchase">logEvent.purchase</option>
                <option value="logEvent.level_complete">logEvent.level_complete</option>
                <option value="logEvent.custom_event">logEvent.custom_event</option>
            </select>
        </div>
    </div>

    <script>
        FBInstant.initializeAsync()
            .then(function () {
                console.log("SDK Initialized");
                FBInstant.setLoadingProgress(100);
                return FBInstant.startGameAsync();
            })
            .then(function () {
                var playerId = FBInstant.player.getID();
                var status = document.getElementById('game-status');
                status.innerText = "Hello, " + playerId;
                startGameLoop();
            })
            .catch(function (error) {
                console.error("Error during initialization:", error);
            });

        function startGameLoop() {
            console.log("Game loop is now running.");
            (async () => {
                try {
                    const _result = await loadProfile();
                } catch (e) {
                    console.error(e);
                }
            })();
        }

        async function loadProfile() {
            const profileOverlay = await FBInstant.overlayViews.createOverlayViewAsync(
                'overlay/profile_view.xml',
                document.getElementById('top_profile'),
                "width: 100%; height:100px; background-color: blue;",
                "css/styles.css",
                { score: 30 }
            );
            profileOverlay.showAsync();
        }

    </script>
</body>

</html>